# 安心終活ナビ ポータルサービス設計書

> 作成日: 2026年2月21日
> 目的: 終活マッチングプラットフォームの課金モデル・成約検知・不正対策の設計
> 前提: ロードマップ（`終活プラットフォーム_ロードマップ.md`）に基づく
> 技術スタック: Next.js 16 (App Router) + Supabase + Cloudflare Workers (OpenNext)
> フロントエンド実装状況: MVP構築済み（モックデータ、DALパターン採用）

---

## 1. 競合調査サマリー

### 1-1. 鎌倉新書（いい葬儀・いいお墓）の実態

IR（有価証券報告書 第41期）から判明したデータ:

| 項目 | 数値 |
|------|------|
| 全社売上高 | 70.6億円 |
| お墓事業（最大） | 23.4億円（33.1%） |
| 葬祭事業 | 13.5億円（19.1%） |
| 介護事業 | 6.4億円 |
| 相続事業 | 7.3億円 |
| 年間利用ユーザー | 約20万人 |
| 広告宣伝費 | 17.2億円（売上の24.3%） |
| 売上総利益率 | 55.6% |
| 収益タイプ | 成約手数料収益 + 広告掲載料収益 |

**いい葬儀の推定手数料率: 約5〜10%（中央値 7〜8%）**
- 葬祭事業売上 13.5億円 ÷ 推定成約総額 165億円 ≒ 8.2%
- 年間紹介約3万件、推定成約15,000件、平均葬儀単価110万円で算出

### 1-2. 国内外マッチングプラットフォーム 課金モデル比較

#### 国内プラットフォーム

| プラットフォーム | 業界 | 課金モデル | 成約確認方法 |
|---------------|------|-----------|------------|
| いい葬儀 | 葬儀 | 成約課金（成果報酬） | 電話紹介ID + ユーザーフォローアップ |
| いいお墓 | 墓地・霊園 | 成約課金（成果報酬） | お祝い金制度 + 見学予約ID |
| SUUMO | 不動産 | 掲載課金（月額固定） | 不要 |
| HOME'S | 不動産 | 反響課金 + 掲載課金 | 不要（問い合わせ時点で課金） |
| ホームプロ | リフォーム | 紹介課金500円/件 + 成約課金6% | 自己申告 + 工事完成保証連動 |
| リショップナビ | リフォーム | 紹介課金のみ（5,000〜30,000円/件） | 不要 |
| 引越し侍 | 引越し | 送客課金（リード課金） | 不要（情報提供で完結） |
| 弁護士ドットコム | 士業 | 掲載課金（月額2〜5万円） | 不要（弁護士法72条の制約） |
| 税理士ドットコム | 士業 | 成約課金（年間報酬の72%） | コーディネーターの人的介在 |
| LIFULL介護 | 介護 | 掲載課金（月額固定） | 不要 |
| みんなの介護 | 介護 | 入居成約課金（10万円以上/件） | 入居お祝い金 + 入居事実確認 |

#### 海外プラットフォーム

| プラットフォーム | 業界 | 課金モデル | 成約確認方法 |
|---------------|------|-----------|------------|
| Thumbtack | サービス全般 | リード課金（$5〜$100+/件） | 不要 |
| Angi（HomeAdvisor） | ホームサービス | リード課金 + 年会費$350 | 不要 |
| Zillow Flex | 不動産 | 成約課金（GCIの15〜40%） | MLS連携 + 書類提出 + エスクロー |
| Care.com | 介護・シッター | サブスク + 取引手数料10% | プラットフォーム内決済（Booking経由） |
| Bark.com | サービス全般 | クレジット制リード購入 | 不要 |
| Houzz | リフォーム | サブスク（月額$65〜$249） | 不要 |

### 1-3. 調査から得られた重要な知見

#### 成約課金が機能する条件

1. **成約アクションの明確性**: 入居・契約など「有無」が明確に判定できること
2. **プラットフォームのプロセス関与度**: コーディネーターや保証制度で取引に深く関与していること
3. **中抜き防止のインセンティブ設計**: 保証制度（ホームプロ）、お祝い金（みんなの介護）など報告動機の付与
4. **単価の高さ**: 追跡コストを吸収できるだけの取引単価があること

#### 成約検知で最も確実に機能しているのはZillow Flexのみ

- MLS（公的取引データベース）で全取引が記録される業界特殊性
- エスクロー経由の決済が業界標準
- 1件あたり数千万円なので検証コストを正当化できる

#### 日本の終活領域の現実

いい葬儀を含む日本の成約課金プラットフォームはいずれも「完璧な検知」は諦めており、**インセンティブ設計で報告率を上げる**方向で運用している。

---

## 2. 安心終活ナビの課金モデル設計

### 2-1. 設計方針

全カテゴリを一律の課金方式にするのではなく、**カテゴリの特性に合わせて課金方式を使い分ける「ハイブリッド課金モデル」**を採用する。

```
┌─────────────────────────────────────────────────┐
│          安心終活ナビ 課金モデル全体像             │
├─────────────┬───────────────────────────────────┤
│  メイン収益  │  反響課金（リード課金）             │
│  （全カテゴリ）│  → 問い合わせ発生時点で確定課金     │
│             │  → 成約検知不要で確実に収益化        │
├─────────────┼───────────────────────────────────┤
│  追加収益    │  成約課金（成功報酬）               │
│  （高単価のみ）│  → 葬儀・お墓・介護施設のみ        │
│             │  → 成約検知の仕組みとセットで導入     │
├─────────────┼───────────────────────────────────┤
│  将来の収益  │  掲載課金（プレミアム枠）           │
│  （成長後）  │  → 事業者が増えてから上位表示枠を販売 │
└─────────────┴───────────────────────────────────┘
```

**ロードマップからの変更点と理由:**

| ロードマップの設定 | 今回の提案 | 変更理由 |
|------------------|-----------|---------|
| 葬儀 15% | 反響5,000円 + 成約5% | 15%はいい葬儀（推定7-8%）の約2倍で参入障壁が高い。反響課金で確実に回収 |
| 介護 30,000円/件 | 反響3,000円 + 成約30,000円 | 反響課金で最低限を確保しつつ、成約課金で上乗せ |
| お墓 10% | 反響3,000〜5,000円（2段階） | 検討期間が長すぎて成約追跡が困難。反響課金メインが現実的 |
| 遺品整理 15% | 反響3,000円のみ | 中単価で成約追跡コストに見合わない |
| 相続 30,000円/件 | 反響3,000円のみ | 成約の定義が曖昧 + 士業紹介の法的リスク |
| 保険（未設定） | 反響2,000円のみ | 相談無料が一般的。保険契約の追跡は困難。掲載ハードルを下げる |

### 2-2. カテゴリ別の特性分析

| カテゴリ | スラッグ | 平均単価 | 緊急性 | 検討期間 | 成約の明確さ | 主な接点 |
|---------|---------|---------|--------|---------|------------|---------|
| 葬儀 | `sougi` | 110万円 | 極高 | 数時間〜数日 | 高（施行の有無） | 電話 |
| お墓 | `ohaka` | 70〜160万円 | 低 | 数週間〜数年 | 高（契約の有無） | Web |
| 介護施設 | `kaigo` | 月15〜30万円 | 中 | 数週間〜数ヶ月 | 高（入居の有無） | Web + 電話 |
| 遺品整理 | `ihinseiri` | 15〜50万円 | 中 | 数日〜数週間 | 高（作業実施の有無） | Web |
| 相続相談 | `souzoku` | 3〜30万円 | 低 | 数週間〜数ヶ月 | 曖昧（何をもって成約か） | Web |
| 保険相談 | `hoken` | 相談無料（契約時数万円〜） | 低 | 数週間〜数ヶ月 | 中（保険契約の有無） | Web |

> **補足:** カテゴリスラッグはフロントエンド（`src/lib/constants.ts`の`VALID_CATEGORIES`）とバックエンド（Supabase）で統一する。URL構造は `/{categorySlug}/{prefectureSlug}/{citySlug}/` 形式。

### 2-3. カテゴリ別 課金設計

#### 葬儀（高単価 × 高緊急性）

```
課金方式: 反響課金 5,000円/件 + 成約課金 5%
成約検知: 電話紹介ID + ユーザーフォローアップ電話
```

- 葬儀は緊急性が高く電話問い合わせが主体
- ユーザー→プラットフォーム→葬儀社の導線を徹底し、初期接点を握る
- 成約確認は葬儀後3〜7日にユーザーに電話で確認（兼アフターフォロー）
- 反響課金で最低限の収益を確保しつつ、成約課金で高単価案件の上乗せ

**収益例:** 成約1件（葬儀費用110万円）= 反響5,000円 + 成約55,000円 = 60,000円

#### お墓（高単価 × 低緊急性）

```
課金方式: 反響課金 3,000円/件（資料請求）+ 5,000円/件（見学予約）
成約検知: お祝い金制度 + ユーザーアンケートメール
```

- お墓はWeb経由が主流で検討期間が長い → SEO記事との親和性最高
- いいお墓のAmazonギフト券方式を参考に、見学・成約時の特典でトラッキング
- 反響課金を2段階（資料請求/見学予約）にして収益を最大化
- 成約課金は検討期間の長さから初期は見送り（将来的に追加検討）

**収益例:** 資料請求1件 = 3,000円、見学予約1件 = 5,000円

#### 介護施設（継続課金 × 中緊急性）

```
課金方式: 反響課金 3,000円/件 + 入居成約 30,000円/件
成約検知: お祝い金制度 + 施設からの入居報告
```

- みんなの介護モデルを参考
- 入居お祝い金（5,000〜10,000円）をユーザーに出し、ユーザー側から入居を報告させる
- 施設側も入居報告 → 両者一致で成約確定（ダブルサイドバリデーション）

**収益例:** 入居成約1件 = 反響3,000円 + 成約30,000円 = 33,000円

#### 遺品整理（中単価 × 中緊急性）

```
課金方式: 反響課金 3,000円/件のみ
成約検知: 不要（反響課金のみのため）
```

- 単価が中程度で成約課金の追跡コストに見合わない
- リード課金のみで収益化し、運営コストを抑える
- 将来的に取引量が増えたら成約課金の追加を検討

#### 相続相談（低〜中単価 × 成約が曖昧）

```
課金方式: 反響課金 3,000円/件のみ
成約検知: 不要（反響課金のみのため）
```

- 弁護士ドットコムのように、成約の定義が曖昧な士業は反響課金が合理的
- 弁護士法72条（事件の周旋対価の禁止）に配慮し、成約報酬は採用しない
- 相談予約の紹介料として課金

#### 保険相談（相談無料 × 低〜中単価）

```
課金方式: 反響課金 2,000円/件のみ
成約検知: 不要（反響課金のみのため）
```

- FP相談・保険見直しは相談自体が無料のケースが多い
- 保険契約の成約追跡は困難（保険会社側のデータにアクセスできない）
- 反響課金を低めに設定し、保険代理店・FP事務所の掲載ハードルを下げる

---

## 3. 成約検知の技術設計

### 3-1. 成約検知方法の比較

| 方法 | 確実性 | コスト | 実装難易度 | 推奨フェーズ |
|------|--------|--------|-----------|------------|
| プラットフォーム経由決済（エスクロー） | 最高 | 高（決済手数料） | 高 | Phase 3以降 |
| ダブルサイドバリデーション + 統計検知 | 高 | 低 | 中 | Phase 2 |
| ユーザーフォローアップメール | 中 | 低（メール配信費のみ） | 低 | Phase 1 |
| お祝い金制度 | 中〜高 | 中（5,000〜10,000円/件） | 低 | Phase 1 |
| 事業者の自己申告のみ | 低 | ゼロ | 低 | Phase 1 |
| コールトラッキング | 高 | 中（番号維持費） | 中 | Phase 2 |
| ミステリーショッパー | 最高 | 高（人件費） | 低 | Phase 3 |

### 3-2. 段階的実装計画

#### Phase 1（ローンチ時）: 反響課金の基盤 + 基本的な成約追跡

```
全問い合わせ → プラットフォームのフォーム経由
             → Supabaseに自動記録（リードID発番）
             → 事業者にメール通知
             → 反響課金を自動計算

成約追跡（高単価カテゴリのみ）:
  → 事業者管理画面でステータス更新（自己申告）
  → ユーザーにフォローアップメール（7日/14日/30日後）
  → お祝い金制度で成約報告のインセンティブ付与
```

#### Phase 2（3〜6ヶ月後）: クロスバリデーション + 統計検知

```
追加する仕組み:
  → 事業者とユーザーの報告を自動照合（不一致検出）
  → 事業者ごとの成約率を自動計算（異常値アラート）
  → コールトラッキング導入（電話問い合わせの追跡）
  → 運営ダッシュボードでモニタリング
```

#### Phase 3（6ヶ月〜1年後）: 決済統合 + 高精度検知

```
追加する仕組み:
  → Stripe Connect導入（プラットフォーム経由決済）
  → ミステリーショッパーによる定期調査
  → 事業者信頼スコアの自動計算 → 掲載順位への反映
```

### 3-3. データベース設計（Supabase）

既存の`inquiries`テーブルを拡張し、成約追跡に対応する。

```sql
-- =============================================
-- リード（問い合わせ）テーブル
-- 既存inquiriesテーブルを置き換え
-- =============================================
CREATE TABLE leads (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  lead_number TEXT UNIQUE NOT NULL,     -- L-20260221-001 形式（自動採番）

  -- ユーザー情報
  user_name TEXT NOT NULL,
  user_email TEXT NOT NULL,
  user_phone TEXT,
  user_id UUID REFERENCES auth.users(id),  -- 登録ユーザーの場合

  -- 紹介先情報
  provider_id UUID REFERENCES providers(id),
  category TEXT NOT NULL,               -- sougi, ohaka, kaigo, souzoku, ihinseiri, hoken
                                        -- ※ フロントのVALID_CATEGORIESと統一
  area_id UUID REFERENCES areas(id),

  -- リード種別
  lead_type TEXT NOT NULL,              -- inquiry（相談）, document_request（資料請求）,
                                        -- visit_booking（見学予約）, phone_call（電話）,
                                        -- estimate（見積もり依頼）
  message TEXT,

  -- リードステータス
  status TEXT DEFAULT 'new',            -- new, sent, contacted, negotiating,
                                        -- closed_won, closed_lost, expired

  -- 反響課金
  lead_fee NUMERIC NOT NULL DEFAULT 0,  -- このリードの課金額（カテゴリ×種別で自動計算）
  lead_fee_status TEXT DEFAULT 'pending', -- pending, billed, paid

  -- 成約追跡（葬儀・お墓・介護のみ使用）
  provider_reported_status TEXT,         -- contacted, won, lost（事業者の報告）
  provider_reported_at TIMESTAMPTZ,
  provider_reported_amount NUMERIC,      -- 事業者が報告した成約金額

  user_reported_status TEXT,             -- satisfied, contracted, cancelled（ユーザーの報告）
  user_reported_at TIMESTAMPTZ,

  -- 成約課金（成約確定後に計算）
  deal_amount NUMERIC,                   -- 確定した成約金額
  commission_rate NUMERIC,               -- 手数料率
  commission_amount NUMERIC,             -- 手数料額
  commission_status TEXT DEFAULT 'none', -- none, calculated, billed, paid

  -- 検証
  is_verified BOOLEAN DEFAULT false,     -- クロスバリデーション済み
  verification_method TEXT,              -- auto（自動照合）, manual（手動確認）, reward（お祝い金申請）
  mismatch_flag BOOLEAN DEFAULT false,   -- 事業者・ユーザー報告の不一致フラグ

  -- メタ
  source TEXT,                           -- seo_article, portal_search, direct, phone
  utm_source TEXT,
  utm_medium TEXT,
  utm_campaign TEXT,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- リード番号の自動採番
CREATE OR REPLACE FUNCTION generate_lead_number()
RETURNS TRIGGER AS $$
DECLARE
  today_count INT;
BEGIN
  SELECT COUNT(*) + 1 INTO today_count
  FROM leads
  WHERE DATE(created_at) = CURRENT_DATE;

  NEW.lead_number := 'L-' || TO_CHAR(CURRENT_DATE, 'YYYYMMDD') || '-' || LPAD(today_count::TEXT, 3, '0');
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_lead_number
  BEFORE INSERT ON leads
  FOR EACH ROW EXECUTE FUNCTION generate_lead_number();

-- 反響課金の自動計算
CREATE OR REPLACE FUNCTION calculate_lead_fee()
RETURNS TRIGGER AS $$
BEGIN
  NEW.lead_fee := CASE
    -- 葬儀
    WHEN NEW.category = 'sougi' THEN 5000
    -- お墓（種別で分岐）
    WHEN NEW.category = 'ohaka' AND NEW.lead_type = 'document_request' THEN 3000
    WHEN NEW.category = 'ohaka' AND NEW.lead_type = 'visit_booking' THEN 5000
    WHEN NEW.category = 'ohaka' THEN 3000
    -- 介護
    WHEN NEW.category = 'kaigo' THEN 3000
    -- 遺品整理
    WHEN NEW.category = 'ihinseiri' THEN 3000
    -- 相続
    WHEN NEW.category = 'souzoku' THEN 3000
    -- 保険
    WHEN NEW.category = 'hoken' THEN 2000
    ELSE 0
  END;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_lead_fee
  BEFORE INSERT ON leads
  FOR EACH ROW EXECUTE FUNCTION calculate_lead_fee();


-- =============================================
-- フォローアップスケジュール
-- リード発生後に自動メールを送信するためのスケジュール管理
-- =============================================
CREATE TABLE followups (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  lead_id UUID REFERENCES leads(id) ON DELETE CASCADE,
  type TEXT NOT NULL,                   -- email_7d, email_14d, email_30d, phone_3d
  scheduled_at TIMESTAMPTZ NOT NULL,
  sent_at TIMESTAMPTZ,
  response_token TEXT UNIQUE,           -- メール内ワンクリック回答用トークン
  user_response TEXT,                   -- clicked_won, clicked_lost, clicked_ongoing
  responded_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- リード作成時にフォローアップを自動スケジュール
CREATE OR REPLACE FUNCTION schedule_followups()
RETURNS TRIGGER AS $$
BEGIN
  -- 7日後メール
  INSERT INTO followups (lead_id, type, scheduled_at, response_token)
  VALUES (NEW.id, 'email_7d', NEW.created_at + INTERVAL '7 days', gen_random_uuid()::TEXT);

  -- 14日後メール
  INSERT INTO followups (lead_id, type, scheduled_at, response_token)
  VALUES (NEW.id, 'email_14d', NEW.created_at + INTERVAL '14 days', gen_random_uuid()::TEXT);

  -- 30日後メール（最終確認）
  INSERT INTO followups (lead_id, type, scheduled_at, response_token)
  VALUES (NEW.id, 'email_30d', NEW.created_at + INTERVAL '30 days', gen_random_uuid()::TEXT);

  -- 葬儀カテゴリは3日後に電話フォローも追加
  IF NEW.category = 'sougi' THEN
    INSERT INTO followups (lead_id, type, scheduled_at, response_token)
    VALUES (NEW.id, 'phone_3d', NEW.created_at + INTERVAL '3 days', gen_random_uuid()::TEXT);
  END IF;

  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_schedule_followups
  AFTER INSERT ON leads
  FOR EACH ROW EXECUTE FUNCTION schedule_followups();


-- =============================================
-- お祝い金（成約トラッキング用インセンティブ）
-- =============================================
CREATE TABLE rewards (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  lead_id UUID REFERENCES leads(id) ON DELETE CASCADE,
  user_name TEXT NOT NULL,
  user_email TEXT NOT NULL,

  reward_type TEXT NOT NULL,            -- visit_reward（見学特典）, contract_reward（成約特典）
  amount NUMERIC NOT NULL,              -- 特典金額

  -- 成約証明
  provider_name TEXT,                    -- 事業者名（ユーザー記入）
  contract_date DATE,                    -- 契約日
  contract_amount NUMERIC,               -- 契約金額（任意）
  evidence_url TEXT,                     -- 契約書等のアップロードURL（任意）

  -- ステータス
  status TEXT DEFAULT 'pending',         -- pending, reviewing, approved, paid, rejected
  reviewed_by TEXT,                       -- 審査者
  reviewed_at TIMESTAMPTZ,
  rejection_reason TEXT,

  created_at TIMESTAMPTZ DEFAULT now()
);


-- =============================================
-- 事業者別 成約統計ビュー（異常検知用）
-- =============================================
CREATE VIEW provider_conversion_stats AS
SELECT
  p.id AS provider_id,
  p.name AS provider_name,
  l.category,
  COUNT(l.id) AS total_leads,
  COUNT(CASE WHEN l.status = 'closed_won' THEN 1 END) AS won_leads,
  COUNT(CASE WHEN l.status = 'closed_lost' THEN 1 END) AS lost_leads,
  COUNT(CASE WHEN l.status = 'expired' THEN 1 END) AS expired_leads,
  -- 成約率
  ROUND(
    COUNT(CASE WHEN l.status = 'closed_won' THEN 1 END)::NUMERIC
    / NULLIF(COUNT(CASE WHEN l.status IN ('closed_won', 'closed_lost') THEN 1 END), 0)
    * 100, 2
  ) AS conversion_rate,
  -- 不一致件数（ユーザーが「契約した」と言っているのに事業者が報告していない）
  COUNT(CASE
    WHEN l.user_reported_status = 'contracted'
    AND l.provider_reported_status IS DISTINCT FROM 'won'
    THEN 1
  END) AS mismatch_count,
  -- 反響課金の合計
  SUM(l.lead_fee) AS total_lead_fees,
  -- 成約課金の合計
  SUM(COALESCE(l.commission_amount, 0)) AS total_commissions
FROM providers p
LEFT JOIN leads l ON l.provider_id = p.id
GROUP BY p.id, p.name, l.category;


-- =============================================
-- 不一致検出ビュー（運営アラート用）
-- =============================================
CREATE VIEW lead_mismatches AS
SELECT
  l.id,
  l.lead_number,
  l.category,
  l.created_at,
  p.name AS provider_name,
  l.provider_reported_status,
  l.user_reported_status,
  CASE
    WHEN l.user_reported_status = 'contracted'
    AND l.provider_reported_status = 'lost' THEN 'MISMATCH_SUSPECT'
    WHEN l.user_reported_status = 'contracted'
    AND l.provider_reported_status IS NULL THEN 'UNREPORTED'
    WHEN l.provider_reported_status = 'won'
    AND l.user_reported_status = 'cancelled' THEN 'FALSE_REPORT'
    ELSE 'OK'
  END AS flag
FROM leads l
JOIN providers p ON p.id = l.provider_id
WHERE l.user_reported_status IS NOT NULL
  OR l.provider_reported_status IS NOT NULL;


-- =============================================
-- 月次請求サマリービュー
-- =============================================
CREATE VIEW monthly_billing AS
SELECT
  p.id AS provider_id,
  p.name AS provider_name,
  DATE_TRUNC('month', l.created_at) AS billing_month,
  -- 反響課金
  COUNT(l.id) AS lead_count,
  SUM(l.lead_fee) AS total_lead_fees,
  -- 成約課金
  COUNT(CASE WHEN l.commission_status != 'none' THEN 1 END) AS commission_count,
  SUM(COALESCE(l.commission_amount, 0)) AS total_commissions,
  -- 合計
  SUM(l.lead_fee) + SUM(COALESCE(l.commission_amount, 0)) AS total_billing
FROM leads l
JOIN providers p ON p.id = l.provider_id
WHERE l.lead_fee_status != 'pending'
GROUP BY p.id, p.name, DATE_TRUNC('month', l.created_at);
```

### 3-4. フォローアップメールの仕組み

フォローアップメールはSupabase Edge Functions + cronで自動送信する。

```
フォローアップメールのフロー:

[Supabase cron] 毎日朝9時に実行
    ↓
[Edge Function] followupsテーブルから送信予定を取得
    ↓
[メール送信] Resend/SendGrid APIでメール送信
    ↓
[ユーザー] メール受信 → ワンクリックで回答
    ↓
[Next.js API] /api/followup?token=xxx&status=won
    ↓
[Supabase] leadsテーブルのuser_reported_statusを更新
    ↓
[自動照合] 事業者報告と照合 → 不一致ならアラート
```

**メール文面例（7日後）:**

```
件名: ○○様、△△葬儀社とのお打ち合わせはいかがでしたか？

本文:
○○様

先日、安心終活ナビよりご紹介いたしました「△△葬儀社」との件について、
その後の状況をお聞かせいただけますか？

[契約しました]  [まだ検討中です]  [見送りました]

※各ボタンはワンクリックで回答できます

成約された方には、感謝の気持ちとして
Amazonギフト券5,000円分をお送りしております。
```

### 3-5. お祝い金制度の設計

成約トラッキングの精度を上げるためのインセンティブ設計。

| カテゴリ | 見学/面談特典 | 成約特典 | 条件 |
|---------|------------|---------|------|
| 葬儀 | — | 10,000円 | フォローアップメールで成約報告 |
| お墓 | 3,000円（見学） | 10,000円 | 見学予約ID + 成約報告 |
| 介護施設 | — | 10,000円 | 入居報告 + 入居証明書類の提出 |
| 遺品整理 | — | — | 反響課金のみのため不要 |
| 相続相談 | — | — | 反響課金のみのため不要 |

**お祝い金のROI:**
- お祝い金コスト: 10,000円/件
- 葬儀の成約課金収入: 55,000円/件（110万円 × 5%）
- 差引利益: 45,000円/件 → **お祝い金の5.5倍の収益**

---

## 4. 不正対策の設計

### 4-1. 想定される不正パターンと対策

#### パターン1: 事業者が成約を報告しない（手数料回避）

| 対策 | 実装時期 | 効果 |
|------|---------|------|
| ユーザーフォローアップメール | Phase 1 | ユーザー側から成約を確認 |
| お祝い金制度 | Phase 1 | ユーザーの報告動機を作る |
| クロスバリデーション（自動照合） | Phase 2 | 不一致の自動検出 |
| 統計的異常検知 | Phase 2 | 成約率が不自然に低い事業者を検出 |
| ミステリーショッパー | Phase 3 | 覆面調査で直接確認 |
| 掲載停止ペナルティ | Phase 2 | 抑止力 |

#### パターン2: 中抜き（プラットフォームを回避して直接取引）

| 対策 | 実装時期 | 効果 |
|------|---------|------|
| 事業者の連絡先を直接表示しない | Phase 1 | 初期接点をプラットフォームが握る |
| すべての通信をプラットフォーム経由にする | Phase 1 | メッセージ機能で仲介 |
| コールトラッキング | Phase 2 | 電話問い合わせの追跡 |
| お祝い金制度 | Phase 1 | ユーザーが「経由して申し込んだ」と報告する動機 |
| 事業者への価値提供 | 継続 | 管理画面、集客支援など離脱防止 |

#### パターン3: ユーザーによる虚偽のお祝い金申請

| 対策 | 実装時期 | 効果 |
|------|---------|------|
| リードIDとの紐付け必須 | Phase 1 | 存在しないリードの申請を排除 |
| 事業者への確認 | Phase 1 | 成約の裏取り |
| 証明書類の提出（高額特典のみ） | Phase 2 | 虚偽申請の抑止 |

### 4-2. 事業者信頼スコア（Phase 2以降）

```
信頼スコアの計算ロジック:

base_score = 100

減点要素:
  - 不一致検出（ユーザーが成約報告、事業者が未報告）: -20点/件
  - 成約率が業界平均の50%未満: -10点
  - ユーザーからの低評価（★2以下）: -5点/件
  - フォローアップメールで「見送り」が多い: -3点/件

加点要素:
  - 成約報告の迅速性（3日以内）: +5点/件
  - ユーザー満足度が高い（★4以上）: +3点/件
  - 長期継続利用（6ヶ月以上）: +10点

スコアの活用:
  - 80点以上: 通常掲載
  - 60〜79点: 注意リスト（運営がモニタリング）
  - 40〜59点: 警告通知 + 掲載順位降格
  - 40点未満: 一時停止 → 改善要求 → 改善なしなら永久停止
```

### 4-3. ペナルティ制度

```
段階的ペナルティ:

1回目の違反（不一致検出等）: 警告メール
2回目の違反: 掲載順位の降格（検索結果で下位表示）
3回目の違反: 一時停止（1ヶ月間掲載停止）
4回目の違反: アカウント永久停止
```

---

## 5. 中抜き防止の導線設計

プラットフォームを回避した直接取引を構造的に防ぐための設計。

### 5-1. 情報の非対称性を維持する

```
事業者詳細ページに表示する情報:
  ✅ 事業者名
  ✅ 住所（番地まで）
  ✅ 営業時間
  ✅ 料金プラン
  ✅ 口コミ
  ✅ 写真

  ❌ 電話番号（直接表示しない → 「電話で相談する」ボタン経由）
  ❌ メールアドレス（直接表示しない → 問い合わせフォーム経由）
  ❌ 公式サイトURL（リンクを貼らない）
```

### 5-2. 電話問い合わせの仲介

```
ユーザーが「電話で相談する」ボタンをクリック
    ↓
プラットフォームの050番号が表示される（事業者ごとに固定割り当て）
    ↓
ユーザーが電話する
    ↓
コールトラッキングシステムが着信を記録
    ↓
事業者の実際の電話番号に転送
    ↓
リードとして自動記録・課金
```

### 5-3. プラットフォーム経由のメリットを事業者に提供する

事業者がプラットフォームを使い続ける理由を作ることで、中抜きの動機を低減する。

```
事業者管理画面で提供する機能:
  - リード管理（ステータス更新、対応履歴）
  - 月次レポート（送客数、成約数、売上）
  - 口コミ管理（返信機能）
  - 掲載情報の編集（写真、料金、特徴）
  - 競合比較データ（同エリア内の比較）
  - 送客レポートPDF自動生成（事業者の上層部への報告用）
```

---

## 6. 収益シミュレーション

### 6-1. Phase 2想定（5〜8ヶ月目）

| カテゴリ | 月間リード数 | 反響課金 | 成約率 | 成約課金 | 月間売上 |
|---------|------------|---------|--------|---------|---------|
| 葬儀 | 50件 | 250,000円 | 30% | 15件 × 55,000円 = 825,000円 | **1,075,000円** |
| お墓 | 100件 | 400,000円 | — | — | **400,000円** |
| 介護 | 80件 | 240,000円 | 20% | 16件 × 30,000円 = 480,000円 | **720,000円** |
| 遺品整理 | 60件 | 180,000円 | — | — | **180,000円** |
| 相続 | 40件 | 120,000円 | — | — | **120,000円** |
| 保険 | 30件 | 60,000円 | — | — | **60,000円** |
| **合計** | **360件** | **1,250,000円** | | **1,305,000円** | **2,555,000円** |

**ポイント:**
- 反響課金だけで月119万円を確保（成約追跡が不完全でも収益ゼロにならない）
- 成約課金で月130万円を上乗せ
- 合計約250万円で、ロードマップのPhase 3目標（月200万円）を上回る

### 6-2. Phase 3想定（9〜14ヶ月目）

| カテゴリ | 月間リード数 | 反響課金 | 成約課金 | 月間売上 |
|---------|------------|---------|---------|---------|
| 葬儀 | 120件 | 600,000円 | 36件 × 55,000円 = 1,980,000円 | **2,580,000円** |
| お墓 | 250件 | 1,000,000円 | — | **1,000,000円** |
| 介護 | 200件 | 600,000円 | 40件 × 30,000円 = 1,200,000円 | **1,800,000円** |
| 遺品整理 | 150件 | 450,000円 | — | **450,000円** |
| 相続 | 100件 | 300,000円 | — | **300,000円** |
| 保険 | 80件 | 160,000円 | — | **160,000円** |
| **合計** | **900件** | **3,110,000円** | **3,180,000円** | **6,290,000円** |

### 6-3. お祝い金コストの試算

| カテゴリ | 成約件数/月 | 特典単価 | 月間コスト |
|---------|-----------|---------|-----------|
| 葬儀 | 15件 | 10,000円 | 150,000円 |
| お墓（見学） | 30件 | 3,000円 | 90,000円 |
| お墓（成約） | 10件 | 10,000円 | 100,000円 |
| 介護 | 16件 | 10,000円 | 160,000円 |
| **合計** | | | **500,000円** |

お祝い金コスト50万円に対し、成約課金収入130万円 → **ROI 2.6倍**

---

## 7. 事業者向け加盟店規約のポイント

初期段階ではWebサイト上の利用規約として公開する（印紙付き契約書は不要）。

### 7-1. 規約に含めるべき主要条項

```
1. サービス内容と料金体系
   - 掲載無料・反響課金の単価・成約課金の料率を明記
   - 支払い条件（月末締め翌月末払い等）

2. 事業者の義務
   - リード対応の品質基準（24時間以内の初回連絡等）
   - 成約報告の義務（成約後7日以内）
   - 虚偽報告の禁止

3. 禁止事項
   - プラットフォーム紹介ユーザーとの直接取引への誘導
   - ユーザー情報の目的外利用
   - 競合プラットフォームへの転載

4. ペナルティ
   - 虚偽報告時のペナルティ（掲載停止等）
   - 中抜き発覚時のペナルティ

5. 契約解除条件
   - 30日前の書面通知で解除可能
   - 重大な規約違反の場合は即時解除

6. 秘密保持
   - ユーザー個人情報の取り扱い
   - 料金体系の非公開
```

### 7-2. 事業者登録に必要な情報

```
必須:
  - 法人名 / 屆出名
  - 代表者名
  - 所在地
  - 連絡先（電話・メール）
  - サービスカテゴリ
  - 対応エリア
  - 料金プラン情報

推奨（信頼性向上のため）:
  - 法人登記簿謄本
  - 資格証明（葬祭ディレクター、介護福祉士等）
  - 施設写真
  - 損害賠償保険の加入証明
```

---

## 8. 実装優先順位まとめ

### Phase 1（ローンチ時）で必須の実装

- [ ] leads テーブル + 自動採番トリガー
- [ ] 反響課金の自動計算トリガー
- [ ] 問い合わせフォーム（全カテゴリ共通 + カテゴリ別項目）
- [ ] 事業者へのメール通知（Supabase Edge Functions + Resend）
- [ ] フォローアップメール自動送信（7日/14日/30日）
- [ ] ユーザーのワンクリック回答API（`/api/followup`）
- [ ] 事業者管理画面（リードステータス更新）
- [ ] 事業者の連絡先非表示 + フォーム経由のみの導線
- [ ] お祝い金申請フォーム + rewardsテーブル
- [ ] 加盟店規約ページ

### Phase 2（3〜6ヶ月後）で追加

- [ ] クロスバリデーション（自動照合 + 不一致アラート）
- [ ] 事業者成約統計ビュー + 異常検知
- [ ] 事業者信頼スコアの導入
- [ ] コールトラッキング（050番号 + 転送）
- [ ] 運営ダッシュボード
- [ ] 月次請求サマリー + 自動請求書発行
- [ ] ペナルティ制度の運用開始

### Phase 3（6ヶ月〜1年後）で追加

- [ ] Stripe Connect導入（プラットフォーム経由決済）
- [ ] ミステリーショッパーの定期実施
- [ ] プレミアム掲載枠の販売開始
- [ ] AIマッチング（問い合わせ内容から最適事業者を自動推薦）

---

## 9. フロントエンド実装状況（現在のシステム構成）

### 9-1. 技術アーキテクチャ

```
フロントエンド:
  Next.js 16.1.6 (App Router, TypeScript)
  Tailwind CSS v4
  React 19 (Server Components + Client Components)

ホスティング:
  Cloudflare Workers + OpenNext（月額$5〜）
  ※ Vercelより低コスト。10万PVでも$5-6/月程度

データ層:
  現在: モックデータ（src/lib/mock/）
  将来: Supabase（PostgreSQL）
  DALパターン: src/lib/data/ の関数を差し替えるだけでSupabase移行可能
```

### 9-2. 実装済みページ・コンポーネント

| ページ | URL | 状態 |
|--------|-----|------|
| トップページ | `/` | ✅ 実装済み（タブ型統合検索UI） |
| カテゴリ一覧 | `/{category}/` | ✅ 実装済み（SSG 6ページ） |
| 都道府県別一覧 | `/{category}/{prefecture}/` | ✅ 実装済み（動的SSR） |
| 事業者詳細 | `/{category}/detail/{slug}/` | ✅ 実装済み（JSON-LD構造化データ付き） |
| 問い合わせ | `/inquiry/` | ✅ 実装済み（モックsubmit） |
| 市区町村API | `/api/cities/{prefecture}` | ✅ 実装済み |
| 404ページ | 全パス | ✅ 実装済み |

### 9-3. トップページUI構成（最新）

e-sogi.comのUXを参考にリデザイン済み:

```
HeroSection         → キャッチコピー + 実績バッジ（250社以上/500件以上/完全無料）
ServiceSearch       → タブ型統合検索（★メインコンポーネント）
  ├ カテゴリタブ     → 葬儀 / お墓 / 介護 / 相続 / 遺品整理 / 保険
  ├ ステップ1        → 地域タブ → 都道府県ボタン選択
  ├ ステップ2        → 市区町村選択（API経由で動的取得）
  └ 検索ボタン       → 「{市区町村名}の{事業者ラベル}を検索する」
HowItWorks          → 3ステップ利用ガイド
TrustSignals        → 信頼シグナル
```

### 9-4. モックデータ（Supabase移行前）

| データ | 件数 | ファイル |
|--------|------|---------|
| カテゴリ | 6件 | `src/lib/mock/categories.ts` |
| 都道府県 | 47件 | `src/lib/mock/areas.ts` |
| 市区町村 | 113件（東京/神奈川/愛知/大阪/福岡） | `src/lib/mock/areas.ts` |
| 事業者 | 約50件 | `src/lib/mock/providers.ts` |
| 口コミ | 複数件 | `src/lib/mock/reviews.ts` |

### 9-5. DALパターン（Data Access Layer）

```typescript
// src/lib/data/ — Supabase移行時はここだけ差し替え
getCategories()           // カテゴリ一覧
getCategoryBySlug(slug)   // カテゴリ詳細
getPrefectures()          // 都道府県一覧
getCitiesByPrefecture(prefSlug)  // 市区町村一覧
getProviders(filter)      // 事業者検索（フィルタ/ソート/ページネーション）
getProviderBySlug(catSlug, slug) // 事業者詳細
getReviewsByProvider(id)  // 口コミ一覧
getReviewSummary(id)      // 口コミ統計
submitInquiry(input)      // 問い合わせ送信（→ 将来leadsテーブルに接続）
```

### 9-6. 事業者詳細ページでの導線設計との整合

本設計書の「5. 中抜き防止の導線設計」に基づき、事業者詳細ページの改修が必要:

| 現在の実装 | 必要な変更 |
|-----------|----------|
| `provider.phone` を直接表示 | 「電話で相談する」ボタン経由に変更（Phase 2でコールトラッキング） |
| `provider.website` を直接表示 | 公式サイトURLを非表示に変更 |
| 問い合わせフォームは `/inquiry/` に遷移 | 事業者詳細ページ内に埋め込みフォームを追加 |
| フォーム送信は `console.log` | Supabase `leads` テーブルへの保存に接続 |

> **注意:** これらの変更はSupabase接続（Phase 1後半）以降に実施する。現在のMVPはモックデータで動作確認用。

---

## 参考資料

### 国内プラットフォーム
- [いい葬儀 掲載案内](https://www.e-sogi.com/esogi_keisai)
- [いいお墓 掲載・提携お問い合わせ](https://www.e-ohaka.com/contact_partner/)
- [ホームプロ 工事完成保証](https://www.homepro.jp/about/guarantee.html)
- [葬儀支援ネット 紹介葬儀社について](https://www.sougisupport.net/c_guidance.html)
- [弁護士ドットコム 有料サービス](https://www.bengo4.com/lawyer/service_plan/)
- [鎌倉新書 有価証券報告書 第41期](競合企業IR/いい葬儀IR.pdf)

### 海外プラットフォーム
- [Zillow Flex FAQ](https://www.zillow.com/z/flex-performance-terms/flex-faq/)
- [Thumbtack Lead Pricing](https://help.thumbtack.com/article/pay-for-leads)
- [Care.com Background Checks](https://www.care.com/about/safety/background-checks/)
- [Bark.com Lead Screening](https://help.bark.com/hc/en-us/articles/13346198848156)
- [Houzz Pro Pricing](https://www.houzz.com/houzz-pro/pricing)
