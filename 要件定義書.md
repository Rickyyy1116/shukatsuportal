# 安心終活ナビ ポータル — 要件定義書

> 作成日: 2026年2月21日
> プロジェクト: 安心終活ナビ マッチングポータル
> ドメイン: portal.shukatsu-ansin.com
> 運営: 株式会社Nexa

---

## 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [ビジネス要件](#2-ビジネス要件)
3. [技術スタック](#3-技術スタック)
4. [システムアーキテクチャ](#4-システムアーキテクチャ)
5. [URL設計・ルーティング](#5-url設計ルーティング)
6. [ページ仕様](#6-ページ仕様)
7. [データモデル](#7-データモデル)
8. [コンポーネント設計](#8-コンポーネント設計)
9. [データアクセスレイヤー（DAL）](#9-データアクセスレイヤーdal)
10. [SEO要件](#10-seo要件)
11. [デザイン仕様](#11-デザイン仕様)
12. [ホスティング・インフラ](#12-ホスティングインフラ)
13. [フェーズ計画](#13-フェーズ計画)
14. [現在の実装状況](#14-現在の実装状況)
15. [次フェーズのタスク](#15-次フェーズのタスク)

---

## 1. プロジェクト概要

### 1-1. 背景

安心終活ナビ（shukatsu-ansin.com）は現在WordPress上でSEO記事メディアとして運営中。これを鎌倉新書（いい葬儀・いいお墓等）のビジネスモデルを参考に、**終活サービスのマッチングプラットフォーム**へと進化させる。

### 1-2. コンセプト

「終活に関するあらゆるサービスを、無料で比較・相談できるポータルサイト」

- 消費者（ユーザー）: 完全無料で葬儀社・霊園・介護施設等を検索・比較・相談
- 事業者: 完全成果報酬型で掲載（初期費用・月額費用なし）
- 収益モデル: 成約時の手数料（10〜20%）+ アフィリエイト収益

### 1-3. 参考サイト

| サイト | 運営 | 参考ポイント |
|--------|------|-------------|
| いい葬儀（e-sogi.com） | 鎌倉新書 | UI/UX、URL設計、地域検索UI |
| いいお墓（e-ohaka.com） | 鎌倉新書 | 霊園検索のフィルター設計 |
| いい介護（e-nursingcare.com） | 鎌倉新書 | 施設検索、入居相談フロー |

### 1-4. システム構成の全体像

```
[消費者]
  │
  ├── shukatsu-ansin.com/          ← WordPress（ConoHa VPS）
  │     └── SEO記事群・ガイド       ← 既存。CTA・バナーでポータルへ誘導
  │           ↓
  ├── portal.shukatsu-ansin.com/   ← Next.js（Cloudflare Workers）
  │     ├── /                       ← ポータルトップ（検索UI）
  │     ├── /sougi/tokyo/           ← 地域×カテゴリ検索
  │     ├── /sougi/detail/[slug]/   ← 事業者詳細
  │     ├── /inquiry/               ← 相談・資料請求
  │     └── /estimate/              ← 一括見積もり（将来）
  │           │
  │           ↓ DAL（データアクセスレイヤー）
  │
  │     ┌──────────────────────────────────┐
  │     │         Supabase（将来移行）         │
  │     │  ├── Database（PostgreSQL）          │
  │     │  ├── Auth（事業者ログイン）            │
  │     │  ├── Storage（画像・資料）            │
  │     │  ├── Realtime（通知）               │
  │     │  └── Edge Functions（メール等）       │
  │     └──────────────────────────────────┘
  │
[事業者]  ← Phase 3で管理画面を構築
```

---

## 2. ビジネス要件

### 2-1. ターゲットユーザー

| ユーザー種別 | ペルソナ | 主な利用シーン |
|-------------|---------|--------------|
| 消費者（主） | 50〜70代、終活を検討中の本人 | 葬儀社探し、霊園探し、介護施設探し |
| 消費者（副） | 30〜50代、親の終活を代行する子世代 | 情報収集、事業者比較、見積もり依頼 |
| 事業者 | 葬儀社、霊園、介護施設、税理士等 | 集客、問い合わせ受信、口コミ管理 |

### 2-2. サービスカテゴリ（6種）

| スラッグ | 日本語名 | 事業者呼称 | アイコン | 説明 |
|---------|---------|-----------|---------|------|
| `sougi` | 葬儀 | 葬儀社 | 🕯️ | 全国の葬儀社を口コミ・料金で比較。家族葬・一般葬・直葬に対応 |
| `ohaka` | お墓 | 霊園・墓地 | 🪦 | 霊園・墓地・納骨堂を検索。樹木葬・永代供養墓も |
| `kaigo` | 介護 | 介護施設 | 🏥 | 介護施設・老人ホームを条件で検索。入居相談も無料 |
| `souzoku` | 相続 | 相続専門家 | 📋 | 相続に強い税理士・司法書士・弁護士をマッチング |
| `ihinseiri` | 遺品整理 | 遺品整理業者 | 📦 | 遺品整理・生前整理の専門業者を比較。見積もりも無料 |
| `hoken` | 保険 | 保険相談窓口 | 🛡️ | 終活に関する保険相談。FP・保険代理店を無料紹介 |

### 2-3. 収益モデル

```
Phase 1（MVP）: 収益なし。モックデータでUI構築
Phase 2（収益化開始）:
  ├── アフィリエイト収益（A8.net等）
  └── 成果報酬（問い合わせ1件あたり / 成約金額の10〜20%）

手数料体系案:
  ├── 葬儀: 成約金額の15%（平均単価100万円 → 15万円/件）
  ├── 介護施設: 入居時 30,000円/件
  ├── お墓: 成約金額の10%（平均60万円 → 6万円/件）
  ├── 遺品整理: 成約金額の15%（平均30万円 → 4.5万円/件）
  └── 相続相談: 30,000円/件
```

### 2-4. KPI目標

| 指標 | Phase 1（MVP） | Phase 2 | Phase 3 | Phase 4 |
|------|---------------|---------|---------|---------|
| 掲載事業者数 | 250（自主掲載） | 20（提携） | 100 | 500 |
| 月間PV | 5,000 | 30,000 | 100,000 | 500,000 |
| 月間問い合わせ | 10 | 50 | 500 | 3,000 |
| 月間売上 | ¥0 | ¥100,000 | ¥1,000,000 | ¥5,000,000 |

---

## 3. 技術スタック

### 3-1. フロントエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| Next.js | 16.1.6 | App Router、SSG/SSR、Server Components |
| React | 19.2.3 | UIライブラリ |
| TypeScript | 5.x | 型安全性 |
| Tailwind CSS | 4.x | スタイリング（`@theme inline`ベースのCSS設定） |

### 3-2. バックエンド（将来）

| 技術 | 用途 |
|------|------|
| Supabase（PostgreSQL） | メインDB、Auth、Storage、Realtime |
| Supabase Edge Functions | メール送信、手数料計算、AI推薦 |

### 3-3. インフラ

| 項目 | 選定 | 理由 |
|------|------|------|
| ホスティング | **Cloudflare Workers + OpenNext** | 商用$5/月〜、帯域幅無制限 |
| CDN | Cloudflare（内蔵） | 東京エッジあり、Anycast 300+拠点 |
| DNS | Cloudflare | ホスティングと統合 |
| ドメイン | portal.shukatsu-ansin.com | サブドメインで既存WPと分離 |

### 3-4. 開発ツール

| ツール | 用途 |
|--------|------|
| ESLint | コード品質 |
| PostCSS | Tailwind CSS v4のビルド |
| Noto Sans JP | Webフォント（Google Fonts） |

### 3-5. 注意事項

- **Turbopack非対応**: プロジェクトパスに日本語を含むため、Next.js 16のデフォルトビルダーTurbopackが使えない。`--webpack`フラグでWebpackを使用
- **package.jsonのscripts**: `"dev": "next dev --webpack"`, `"build": "next build --webpack"`

---

## 4. システムアーキテクチャ

### 4-1. DALパターン（データアクセスレイヤー）

コンポーネントとデータソースの間にDAL関数を挟む設計。Supabase移行時はDAL関数の内部実装のみ差し替え、コンポーネントは変更不要。

```
[コンポーネント（TSX）]
       │
       ↓ import { getProviders } from "@/lib/data"
       │
[DAL関数（src/lib/data/*.ts）]
       │
       ├── 現在: モックデータ（src/lib/mock/*.ts）を参照
       └── 将来: Supabase Client でDBクエリ
```

### 4-2. ディレクトリ構造

```
portal/
├── src/
│   ├── app/                          # Next.js App Router
│   │   ├── layout.tsx                # ルートレイアウト
│   │   ├── page.tsx                  # トップページ（/）
│   │   ├── not-found.tsx             # 404ページ
│   │   ├── inquiry/
│   │   │   └── page.tsx              # 問い合わせフォーム
│   │   └── [category]/
│   │       ├── page.tsx              # カテゴリ一覧（/sougi/）
│   │       ├── [prefecture]/
│   │       │   └── page.tsx          # 都道府県一覧（/sougi/tokyo/）
│   │       └── detail/
│   │           └── [slug]/
│   │               └── page.tsx      # 事業者詳細（/sougi/detail/xxx/）
│   ├── components/
│   │   ├── home/                     # トップページ用
│   │   │   ├── HeroSection.tsx       # ヒーロー検索UI（Client）
│   │   │   ├── CategoryCards.tsx     # カテゴリカード6種
│   │   │   ├── AreaSelector.tsx      # 地域タブ選択（Client）
│   │   │   ├── HowItWorks.tsx        # 使い方3ステップ
│   │   │   └── TrustSignals.tsx      # 信頼バッジ
│   │   ├── layout/
│   │   │   ├── Header.tsx            # ナビゲーション（Client）
│   │   │   ├── Footer.tsx            # フッター
│   │   │   └── Breadcrumb.tsx        # パンくず + JSON-LD
│   │   ├── provider/
│   │   │   ├── ProviderCard.tsx      # 事業者カード
│   │   │   ├── ProviderList.tsx      # カードグリッド
│   │   │   ├── ProviderDetail.tsx    # 詳細表示
│   │   │   └── ProviderCTA.tsx       # 固定CTAバー（Client）
│   │   ├── review/
│   │   │   ├── ReviewCard.tsx        # 口コミカード
│   │   │   ├── ReviewSummary.tsx     # 評価分布グラフ
│   │   │   └── ReviewList.tsx        # サマリー+口コミ一覧
│   │   ├── form/
│   │   │   └── InquiryForm.tsx       # 問い合わせフォーム（Client）
│   │   └── ui/
│   │       ├── StarRating.tsx        # 星評価表示
│   │       └── Badge.tsx             # バッジ（5 variant）
│   └── lib/
│       ├── constants.ts              # 定数（カテゴリ、地域グループ等）
│       ├── data/                     # DAL（データアクセスレイヤー）
│       │   ├── index.ts              # 全DAL関数のre-export
│       │   ├── types.ts              # 全型定義
│       │   ├── providers.ts          # getProviders, getProviderBySlug 等
│       │   ├── categories.ts         # getCategories, getCategoryBySlug
│       │   ├── areas.ts              # getPrefectures, getCitiesByPrefecture 等
│       │   ├── reviews.ts            # getReviewsByProvider, getReviewSummary
│       │   └── inquiries.ts          # submitInquiry
│       └── mock/                     # モックデータ（Supabase移行時に削除）
│           ├── categories.ts         # 6カテゴリ
│           ├── areas.ts              # 47都道府県 + 東京23区
│           ├── providers.ts          # 22件の事業者サンプル
│           └── reviews.ts            # 16件の口コミサンプル
├── public/                           # 静的ファイル
├── next.config.ts                    # Next.js設定
├── package.json
├── tsconfig.json
├── postcss.config.mjs
└── .env.example                      # 環境変数テンプレート
```

### 4-3. Client Component と Server Component の分離

| コンポーネント | 種別 | 理由 |
|-------------|------|------|
| HeroSection | Client | フォーム操作（useRouter, useState） |
| AreaSelector | Client | タブ切替の状態管理（useState） |
| Header | Client | モバイルメニューのトグル（useState） |
| ProviderCTA | Client | 固定表示のCTAバー |
| InquiryForm | Client | フォーム入力・バリデーション・送信 |
| その他全て | Server | データフェッチ + 静的レンダリング |

---

## 5. URL設計・ルーティング

### 5-1. URL一覧

| パス | 説明 | 種別 | 例 |
|------|------|------|-----|
| `/` | トップページ | SSG | — |
| `/[category]/` | カテゴリ一覧 | SSG（6ページ） | `/sougi/` |
| `/[category]/[prefecture]/` | 都道府県別一覧 | 動的SSR | `/sougi/tokyo/` |
| `/[category]/[prefecture]/[city]/` | 市区町村別一覧（将来） | 動的SSR | `/sougi/tokyo/shinjuku/` |
| `/[category]/detail/[slug]/` | 事業者詳細 | 動的SSR | `/sougi/detail/tanaka-sougi/` |
| `/inquiry/` | 問い合わせフォーム | 動的SSR | `/inquiry/?provider=xxx` |
| `/estimate/` | 一括見積もり（将来） | 動的SSR | — |

### 5-2. ルーティング衝突回避

Next.js App Routerは静的セグメント（`/inquiry/`, `/estimate/`）を動的セグメント（`/[category]/`）より優先する。追加でcategoryページ内で`VALID_CATEGORIES`によるバリデーションも実施。

```typescript
// 有効なカテゴリスラッグ
const VALID_CATEGORIES = ["sougi", "ohaka", "kaigo", "souzoku", "ihinseiri", "hoken"] as const;

// 不正なスラッグは404
if (!VALID_CATEGORIES.includes(category)) notFound();
```

### 5-3. 静的ページ生成（generateStaticParams）

```
カテゴリページ: 6カテゴリ = 6ページ（SSG）
都道府県ページ: 動的SSR（将来的にISRへ移行可能）
事業者詳細: 動的SSR
```

---

## 6. ページ仕様

### 6-1. トップページ（`/`）

**目的**: カテゴリ×エリアで事業者を検索する入口

| セクション | コンポーネント | 内容 |
|-----------|-------------|------|
| ヒーロー | HeroSection | キャッチコピー + カテゴリselect + 都道府県select + 検索ボタン |
| 実績バッジ | （HeroSection内） | 「250社以上掲載」「500件以上口コミ」「完全無料」 |
| カテゴリ | CategoryCards | 6カテゴリのアイコンカード。クリックでカテゴリ一覧へ |
| エリア選択 | AreaSelector | 6地域タブ→都道府県リンク一覧（デフォルト「関東」） |
| 使い方 | HowItWorks | 3ステップ（検索→比較→相談） |
| 信頼バッジ | TrustSignals | 「利用料完全無料」「全国47都道府県」「24時間受付」 |

**メタデータ**: `安心終活ナビ | 葬儀・お墓・介護・相続の無料相談・見積もり`

### 6-2. カテゴリ一覧ページ（`/[category]/`）

**目的**: 特定カテゴリの事業者を都道府県から選ぶ

| セクション | 内容 |
|-----------|------|
| パンくず | トップ > {カテゴリ名} |
| タイトル | 「{事業者呼称}を探す」 |
| 都道府県リンク | 6地域グループに分けて47都道府県のリンクを表示 |
| 事業者一覧 | 該当カテゴリの全事業者をProviderCardで一覧表示 |

**メタデータ**: `{事業者呼称}を探す | 安心終活ナビ`
**SSG**: 6カテゴリ分を静的生成

### 6-3. 都道府県別一覧ページ（`/[category]/[prefecture]/`）

**目的**: 特定カテゴリ×都道府県の事業者一覧

| セクション | 内容 |
|-----------|------|
| パンくず | トップ > {カテゴリ名} > {都道府県名} |
| タイトル | 「{都道府県名}の{事業者呼称}おすすめ一覧【2026年最新】」 |
| 市区町村リンク | 該当都道府県の市区町村リンク（データがあれば表示） |
| 事業者一覧 | 該当エリアの事業者をProviderCardで表示 |

**メタデータ**: `{都道府県名}の{事業者呼称}おすすめ一覧【2026年最新】 | 安心終活ナビ`

### 6-4. 事業者詳細ページ（`/[category]/detail/[slug]/`）

**目的**: 個別事業者の詳細情報と口コミを表示し、問い合わせに誘導

| セクション | コンポーネント | 内容 |
|-----------|-------------|------|
| パンくず | Breadcrumb | トップ > {カテゴリ} > {都道府県} > {事業者名} |
| 画像 | ProviderDetail | メイン画像（なければプレースホルダ） |
| 基本情報 | ProviderDetail | 事業者名、星評価、住所、電話番号、営業時間、公式サイト |
| 紹介文 | ProviderDetail | 事業者の説明テキスト |
| 料金情報 | ProviderDetail | 料金帯バッジ + 料金詳細テキスト |
| 特徴 | ProviderDetail | 特徴バッジ一覧 |
| 口コミ | ReviewList | 評価分布グラフ + 口コミカード一覧 |
| CTA | ProviderCTA | 画面下部固定バー（電話相談 / 資料請求） |

**構造化データ**: `LocalBusiness` + `AggregateRating`（JSON-LD）
**メタデータ**: `{事業者名}の口コミ・料金 | {都道府県名}の{事業者呼称} | 安心終活ナビ`

### 6-5. 問い合わせページ（`/inquiry/`）

**目的**: 無料相談・資料請求の受付

| フィールド | 種別 | 必須 | 内容 |
|-----------|------|------|------|
| お問い合わせ種別 | ラジオボタン | ○ | 無料相談 / 資料請求 |
| お名前 | テキスト | ○ | — |
| メールアドレス | テキスト | ○ | `@`と`.`の存在チェック |
| 電話番号 | テキスト | — | 任意 |
| お住まいのエリア | セレクト | — | 47都道府県 |
| 関心のあるカテゴリ | セレクト | — | 6カテゴリ |
| ご相談内容 | テキストエリア | — | 自由記述 |

**送信後**: 緑背景の完了メッセージ「お問い合わせありがとうございます。担当者より2営業日以内にご連絡いたします。」

**クエリパラメータ対応**: `?provider=xxx&category=yyy` でデフォルト値をセット

### 6-6. 404ページ

ヘッダー・フッター付き。「404」の大きな数字 + 「ページが見つかりませんでした」メッセージ + トップページへのリンク。

---

## 7. データモデル

### 7-1. TypeScript型定義

#### Provider（事業者）

```typescript
interface Provider {
  id: string;
  name: string;                  // 事業者名
  slug: string;                  // URLスラッグ（一意）
  categorySlug: string;          // カテゴリスラッグ
  description: string;           // 紹介文
  address: string;               // 住所
  phone: string;                 // 電話番号
  website: string;               // 公式サイトURL
  priceRange: "low" | "mid" | "high";  // 料金帯
  priceDetail: string;           // 料金詳細テキスト
  businessHours: string;         // 営業時間
  features: string[];            // 特徴（「24時間対応」「駐車場あり」等）
  images: string[];              // 画像URL一覧
  latitude: number;              // 緯度
  longitude: number;             // 経度
  prefectureSlug: string;        // 都道府県スラッグ
  citySlug: string;              // 市区町村スラッグ
  ratingAvg: number;             // 口コミ平均（0.0〜5.0）
  reviewCount: number;           // 口コミ件数
}
```

#### Category（カテゴリ）

```typescript
interface Category {
  id: string;
  name: string;          // 日本語名（「葬儀」「お墓」等）
  slug: string;          // URLスラッグ
  sortOrder: number;     // 表示順
  icon: string;          // 絵文字アイコン
  description: string;   // カテゴリ説明文
  providerLabel: string; // 事業者の呼称（「葬儀社」「霊園・墓地」等）
}
```

#### Area（エリア）

```typescript
interface Area {
  id: string;
  name: string;              // 日本語名（「東京都」「新宿区」等）
  slug: string;              // URLスラッグ（「tokyo」「shinjuku」等）
  code: string;              // JIS X 0402コード
  parentSlug: string | null; // 親スラッグ（市区町村は都道府県のslug）
  level: 1 | 2;             // 1=都道府県, 2=市区町村
  region: string;            // 地域名（「関東」「近畿」等）
}
```

#### Review（口コミ）

```typescript
interface Review {
  id: string;
  providerId: string;    // 対象事業者ID
  rating: number;        // 1〜5の整数
  content: string;       // 口コミ本文
  serviceType: string;   // 利用サービス種別
  usedAt: string;        // 利用時期（「2026年1月」等）
  authorName: string;    // 投稿者名
  createdAt: string;     // 投稿日時（ISO 8601）
}
```

#### InquiryInput（問い合わせ入力）

```typescript
interface InquiryInput {
  type: "consultation" | "estimate" | "document";
  name: string;
  email: string;
  phone: string;
  prefectureSlug: string;
  categorySlug: string;
  providerIds: string[];
  message: string;
}
```

#### ProviderFilter（検索フィルター）

```typescript
interface ProviderFilter {
  categorySlug?: string;
  prefectureSlug?: string;
  citySlug?: string;
  priceRange?: "low" | "mid" | "high";
  features?: string[];
  sortBy?: "rating" | "reviewCount" | "name";
  page?: number;
  perPage?: number;         // デフォルト: 20
}
```

### 7-2. Supabase テーブル設計（将来のDB移行用）

```sql
-- 事業者マスタ
CREATE TABLE providers (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name TEXT NOT NULL,
  slug TEXT UNIQUE NOT NULL,
  category_id UUID REFERENCES categories(id),
  description TEXT,
  address TEXT,
  phone TEXT,
  website TEXT,
  price_range TEXT CHECK (price_range IN ('low', 'mid', 'high')),
  price_detail TEXT,
  business_hours TEXT,
  features TEXT[],
  images TEXT[],
  latitude DECIMAL(10, 7),
  longitude DECIMAL(10, 7),
  area_id UUID REFERENCES areas(id),
  affiliate_link TEXT,
  is_partner BOOLEAN DEFAULT false,
  rating_avg DECIMAL(2, 1) DEFAULT 0,
  review_count INT DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- サービスカテゴリ
CREATE TABLE categories (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name TEXT NOT NULL,
  slug TEXT UNIQUE NOT NULL,
  sort_order INT
);

-- エリア（都道府県・市区町村）
CREATE TABLE areas (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name TEXT NOT NULL,
  slug TEXT NOT NULL,
  code TEXT,
  parent_id UUID REFERENCES areas(id),
  level INT CHECK (level IN (1, 2))
);

-- 口コミ
CREATE TABLE reviews (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  provider_id UUID REFERENCES providers(id) ON DELETE CASCADE,
  rating INT CHECK (rating BETWEEN 1 AND 5),
  content TEXT,
  service_type TEXT,
  used_at TEXT,
  author_name TEXT,
  is_approved BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- 問い合わせ・見積もり依頼
CREATE TABLE inquiries (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  type TEXT CHECK (type IN ('consultation', 'estimate', 'document')),
  name TEXT NOT NULL,
  email TEXT,
  phone TEXT,
  area_id UUID REFERENCES areas(id),
  category_id UUID REFERENCES categories(id),
  provider_ids UUID[],
  message TEXT,
  status TEXT DEFAULT 'new' CHECK (status IN ('new', 'contacted', 'matched', 'completed')),
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);
```

### 7-3. モックデータ規模（現在）

| データ種別 | 件数 | ファイル |
|-----------|------|---------|
| カテゴリ | 6件 | `src/lib/mock/categories.ts` |
| 都道府県 | 47件 | `src/lib/mock/areas.ts` |
| 市区町村（東京23区） | 23件 | `src/lib/mock/areas.ts` |
| 事業者 | 22件 | `src/lib/mock/providers.ts` |
| 口コミ | 16件 | `src/lib/mock/reviews.ts` |

**事業者のカテゴリ分布**: 葬儀7 / お墓4 / 介護4 / 相続3 / 遺品整理3 / 保険2

---

## 8. コンポーネント設計

### 8-1. UIコンポーネント

#### StarRating

- 星5つの評価表示。full / half / empty の3パターン対応
- Props: `rating: number`（0〜5）, `size: "sm" | "md" | "lg"`
- 色: `accent-warning`（黄色）

#### Badge

- ピル型バッジ。5つのvariant
- Props: `variant: "default" | "primary" | "price-low" | "price-mid" | "price-high"`, `children`
- `price-low`: 青系, `price-mid`: グレー系, `price-high`: オレンジ系

### 8-2. レイアウトコンポーネント

#### Header

- ロゴ「安心終活ナビ」+ 6カテゴリナビ + 「無料相談」ボタン
- `sticky top-0 z-50`
- モバイル: ハンバーガーメニュー

#### Footer

- 3カラム: カテゴリリンク / エリアリンク（関東7都県） / サイト情報
- 背景: `bg-primary-900`（ダークグリーン）
- コピーライト: `© 2026 安心終活ナビ All rights reserved.`

#### Breadcrumb

- `>` 区切り。最後のアイテムはリンクなし
- Schema.org `BreadcrumbList` JSON-LDを出力

### 8-3. 事業者関連コンポーネント

#### ProviderCard

- 横並びカード: 左に画像（128x128）、右に情報
- 表示内容: 事業者名、StarRating、住所、料金帯Badge、特徴Badge（最大3つ）、「詳細を見る」ボタン

#### ProviderDetail

- セクション構成: 画像 → 事業者名・評価 → 基本情報テーブル → 紹介文 → 料金情報 → 特徴

#### ProviderCTA

- 画面下部固定バー（`fixed bottom-0 z-50`）
- 左: 「電話で相談 {phone}」（緑、tel:リンク）
- 右: 「無料で資料請求」（オレンジ、/inquiry?provider={slug}へ遷移）

### 8-4. 口コミ関連コンポーネント

#### ReviewSummary

- 左: 大きな平均評価数値 + StarRating + 件数
- 右: 5段階の星分布横棒グラフ

#### ReviewCard

- StarRating + サービス種別 + 利用時期 → 口コミ本文 → 投稿者名 + 日付

---

## 9. データアクセスレイヤー（DAL）

### 9-1. DAL関数一覧

| ファイル | 関数 | 引数 | 戻り値 |
|---------|------|------|--------|
| `providers.ts` | `getProviders` | `ProviderFilter` | `PaginatedResult<Provider>` |
| `providers.ts` | `getProviderBySlug` | `categorySlug, slug` | `Provider \| null` |
| `providers.ts` | `getPopularProviders` | `limit` | `Provider[]` |
| `categories.ts` | `getCategories` | — | `Category[]` |
| `categories.ts` | `getCategoryBySlug` | `slug` | `Category \| null` |
| `areas.ts` | `getPrefectures` | — | `Area[]` |
| `areas.ts` | `getPrefectureBySlug` | `slug` | `Area \| null` |
| `areas.ts` | `getCitiesByPrefecture` | `prefectureSlug` | `Area[]` |
| `areas.ts` | `getCityBySlug` | `prefectureSlug, citySlug` | `Area \| null` |
| `areas.ts` | `getAreaBySlug` | `slug` | `Area \| null` |
| `reviews.ts` | `getReviewsByProvider` | `providerId` | `Review[]` |
| `reviews.ts` | `getReviewSummary` | `providerId` | `{ avg, count, distribution }` |
| `inquiries.ts` | `submitInquiry` | `InquiryInput` | `{ success, error? }` |

### 9-2. Supabase移行の手順

1. Supabaseプロジェクト作成、テーブル作成（上記SQL実行）
2. `@supabase/supabase-js` + `@supabase/ssr` インストール
3. `.env.local` に `NEXT_PUBLIC_SUPABASE_URL` / `NEXT_PUBLIC_SUPABASE_ANON_KEY` 設定
4. `src/lib/supabase.ts` にクライアント初期化コード作成
5. `src/lib/data/*.ts` の各関数内のモック実装をSupabaseクエリに差し替え
6. `src/lib/mock/` ディレクトリを削除
7. 動作確認・デプロイ

**コンポーネント側の変更は一切不要**。これがDALパターンの最大のメリット。

---

## 10. SEO要件

### 10-1. メタデータ

| ページ | title | description |
|--------|-------|-------------|
| トップ | 安心終活ナビ \| 葬儀・お墓・介護・相続の無料相談・見積もり | 全国の葬儀社・霊園・介護施設・相続専門家を口コミ・料金で比較... |
| カテゴリ一覧 | {事業者呼称}を探す \| 安心終活ナビ | 全国の{事業者呼称}を口コミ・料金で比較。{カテゴリ説明} |
| 都道府県一覧 | {都道府県名}の{事業者呼称}おすすめ一覧【2026年最新】 | {都道府県名}で{事業者呼称}をお探しなら安心終活ナビ... |
| 事業者詳細 | {事業者名}の口コミ・料金 \| {都道府県名}の{事業者呼称} | {事業者名}の口コミ・評判・料金情報... |
| 問い合わせ | 無料相談・資料請求 \| 安心終活ナビ | 終活に関するお悩みをお気軽にご相談ください... |

### 10-2. 構造化データ（JSON-LD）

| ページ | Schema.org型 | 内容 |
|--------|-------------|------|
| 全ページ | `BreadcrumbList` | パンくずリスト |
| 事業者詳細 | `LocalBusiness` | 事業者の名前、住所、電話、緯度経度 |
| 事業者詳細 | `AggregateRating` | 口コミ平均評価、件数 |

### 10-3. 静的ページ生成戦略

```
Phase 1: 6カテゴリページをSSG + 都道府県・詳細は動的SSR
Phase 2: 47都道府県 × 6カテゴリ = 282ページをISRで静的生成
Phase 3: 主要市区町村ページもISR化（数千ページ規模）
```

### 10-4. OGP（Open Graph Protocol）

全ページに `og:title`, `og:description`, `og:url`, `og:type` を設定。
画像は将来的にOGP画像自動生成を検討。

---

## 11. デザイン仕様

### 11-1. ブランドカラー

```css
/* Tailwind CSS v4 @theme inline 設定 */
--color-primary-50:  #f0f7f2;   /* 最も薄いグリーン（背景） */
--color-primary-100: #d4eadb;
--color-primary-200: #a8d5b7;
--color-primary-300: #7dc093;
--color-primary-400: #5eac78;
--color-primary-500: #4a8c5c;   /* メインブランドカラー */
--color-primary-600: #3d7a4e;   /* ボタン・リンク */
--color-primary-700: #2f6840;
--color-primary-800: #225632;
--color-primary-900: #1a3f28;   /* フッター背景 */

--color-accent-warning: #f59e0b; /* CTA（資料請求ボタン等） */
```

### 11-2. フォント

```css
--font-sans: "Noto Sans JP", "Hiragino Sans", "Hiragino Kaku Gothic ProN",
             "Meiryo", sans-serif;
```

- Google Fonts経由で `Noto Sans JP`（weight: 400, 500, 700）を読み込み
- `display: swap` でFOUT対策

### 11-3. レスポンシブ設計

- **モバイルファースト**
- ブレークポイント: Tailwind標準（`sm: 640px`, `md: 768px`, `lg: 1024px`, `xl: 1280px`）
- 最大幅: `max-w-7xl`（1280px）
- カテゴリカード: モバイル2列 → デスクトップ3列 → XL6列
- 事業者カード: 縦1列リスト表示
- ProviderCTA: モバイルで2ボタン横並び

### 11-4. デザインパターン

- ヘッダー: `sticky top-0`, 白背景, 下ボーダー
- フッター: `bg-primary-900`, 白テキスト
- カード: `rounded-xl`, `border`, `hover:shadow-md`
- ボタン（プライマリ）: `bg-primary-600`, `rounded-lg`, `text-white`
- ボタン（CTA）: `bg-accent-warning`, `rounded-lg`, `text-white`
- バッジ: `rounded-full`, `px-3 py-1`, `text-xs`

---

## 12. ホスティング・インフラ

### 12-1. Cloudflare Workers + OpenNext を選定

#### 選定理由

| 比較項目 | Cloudflare Workers | Vercel |
|---------|-------------------|--------|
| 商用利用の最低コスト | **$5/月** | $20/月 |
| 帯域幅課金 | **なし（無制限）** | 1TB超で $0.15/GB |
| Next.js 16対応 | 対応（OpenNext経由） | 完全対応（開発元） |
| 日本エッジ | 東京複数拠点 | 東京1拠点 |
| セットアップ | OpenNext設定が必要 | ゼロ設定 |

#### コスト見積もり（月間1万〜10万PV）

```
Cloudflare Workers Paid プラン:
  基本料金:         $5.00/月
  含まれる無料枠:
    リクエスト数:   1,000万/月
    CPU時間:        3,000万ms/月
    帯域幅:         無制限

  超過料金（10万PV程度では発生しない）:
    リクエスト:     $0.30/100万リクエスト
    CPU時間:        $0.02/100万ms

  追加サービス:
    KV Storage:     1,000万read/月は無料
    Durable Objects: $0.15/100万リクエスト
    R2 Storage:     $0.015/GB/月（画像用、将来）

  月間10万PVでの想定合計: $5〜$6/月
```

### 12-2. ドメイン設定

```
shukatsu-ansin.com          → WordPress（ConoHa VPS）
portal.shukatsu-ansin.com   → Next.js（Cloudflare Workers）
```

CNAMEレコードで `portal` サブドメインをCloudflare Workersに向ける。

### 12-3. デプロイフロー（現行）

```
GitHub Push → Cloudflare Workers 自動デプロイ
  └── main ブランチ → 本番環境
```

---

## 13. フェーズ計画

### Phase 1: ミニマムMVP（現在 ← ここ）

**目標**: モックデータで動くUIを構築し、全ページの表示を確認

| タスク | 状態 |
|--------|------|
| Next.jsプロジェクト初期化 | 完了 |
| 型定義 + モックデータ作成 | 完了 |
| データアクセスレイヤー（DAL） | 完了 |
| UIコンポーネント + レイアウト | 完了 |
| トップページ | 完了 |
| カテゴリ一覧ページ | 完了 |
| 都道府県別一覧ページ | 完了 |
| 事業者詳細ページ | 完了 |
| 問い合わせフォーム | 完了 |
| ビルド成功確認 | 完了 |

### Phase 1.5: Supabase移行 + Cloudflareデプロイ

| タスク | 状態 |
|--------|------|
| Supabaseプロジェクト作成 | 未着手 |
| テーブル作成（SQL実行） | 未着手 |
| 実データ登録（事業者250件目標） | 未着手 |
| DAL関数をSupabaseクエリに差し替え | 未着手 |
| OpenNextアダプター設定 | 完了（`@opennextjs/cloudflare`, `open-next.config.ts`, `wrangler.jsonc`） |
| Cloudflare Workersデプロイ | 実装完了（GitHub Actions設定済み、Secrets設定待ち） |
| portal.shukatsu-ansin.com DNS設定 | 一部未完（Cloudflare側Route設定待ち） |
| WPからの導線（CTA・バナー）設置 | 未着手 |
| メール通知（Resend or SendGrid） | 未着手 |

### Phase 2: 事業者開拓・収益化（5〜8ヶ月目）

- 事業者営業（AI自動化: SNS DM + メール）
- アフィリエイト収益化（A8.net等）
- CRM構築（Supabase + n8n）
- コンテンツ拡充（記事100本）

### Phase 3: プラットフォーム本格化（9〜14ヶ月目）

- 事業者管理画面（Supabase Auth）
- 成約トラッキング・課金基盤
- AIチャットボット
- 全文検索・比較機能

### Phase 4: マルチバーティカル展開（15〜24ヶ月目）

- 6カテゴリの本格化
- 官民協働事業
- クロスユース基盤

---

## 14. 現在の実装状況

### 14-1. ビルド・動作確認済み

```
✅ npm run build（Webpackモード）: 成功
✅ npm run dev: 全ページ200 OK確認済み
✅ npm run build:worker（OpenNext）: 成功
✅ GitHub Actions: `Deploy to Cloudflare Workers` 作成・main連携済み
⚠️ Cloudflareデプロイ実行は Secrets 未設定のため停止（`CLOUDFLARE_API_TOKEN`, `CLOUDFLARE_ACCOUNT_ID`）

ビルド結果:
  ○ /                              → 静的生成（SSG）
  ● /[category]                    → SSG（6パス生成）
  ƒ /[category]/[prefecture]       → 動的SSR
  ƒ /[category]/detail/[slug]      → 動的SSR
  ƒ /inquiry                       → 動的SSR
  ○ /_not-found                    → 静的生成
```

### 14-2. 動作確認済みURL

| URL | ステータス | 確認内容 |
|-----|----------|---------|
| `http://localhost:3000/` | 200 | ヒーロー、カテゴリカード、エリアタブ、フッター |
| `http://localhost:3000/sougi` | 200 | 47都道府県リンク + 葬儀社カード一覧 |
| `http://localhost:3000/sougi/tokyo` | 200 | 東京の葬儀社一覧 |
| `http://localhost:3000/sougi/detail/tanaka-sougi` | 200 | 基本情報、口コミ、固定CTA |
| `http://localhost:3000/inquiry` | 200 | フォーム全フィールド表示 |

### 14-3. 解決済みの技術課題

| 課題 | 原因 | 解決方法 |
|------|------|---------|
| Turbopackビルドエラー | プロジェクトパスに日本語文字（`終活サイト`等） | `--webpack`フラグでWebpackに切替 |
| TypeScript型エラー（`includes`） | `as const`配列のリテラル型が`never`に推論 | `as readonly string[]`でキャスト |
| ProviderDetail propsミスマッチ | ページが未定義のpropsを渡していた | 不要なpropsを削除 |
| Pages向け静的制約で動的機能が使えない | GitHub Pages前提で`output: export`化していた | Cloudflare Workers(OpenNext)前提に戻し、`/api/cities/[prefecture]` と動的ルートを復帰 |

---

## 15. 次フェーズのタスク

### 15-1. 優先度: 高

| # | タスク | 詳細 |
|---|--------|------|
| 1 | Supabaseプロジェクト作成 | supabase.com でFreeプランのプロジェクト作成 |
| 2 | テーブル作成 | 本書のSQL定義を実行 |
| 3 | 事業者データ登録 | 公開情報から主要都市の事業者データを収集（250件目標） |
| 4 | DAL関数のSupabase化 | `src/lib/data/*.ts` の内部実装を差し替え |
| 5 | Cloudflare Secrets設定 | GitHub Secrets に `CLOUDFLARE_API_TOKEN`, `CLOUDFLARE_ACCOUNT_ID` を登録 |
| 6 | Cloudflare本番反映確認 | Actions再実行でWorker作成確認 + `portal.shukatsu-ansin.com/*` Route設定 |
| 7 | メール通知実装 | 問い合わせ受信時のメール送信（Resend推奨） |

### 15-2. 優先度: 中

| # | タスク | 詳細 |
|---|--------|------|
| 8 | 実画像アップロード | Supabase Storage or Cloudflare R2 |
| 9 | サイトマップ生成 | `src/app/sitemap.ts` の実装 |
| 10 | robots.txt | `src/app/robots.ts` の実装 |
| 11 | OGP画像自動生成 | Next.js `ImageResponse` で動的OGP画像 |
| 12 | WPからの導線設置 | 記事内CTA、サイドバーバナー |
| 13 | 一括見積もりフォーム | `/estimate/` ページの実装 |

### 15-3. 優先度: 低（Phase 2以降）

| # | タスク | 詳細 |
|---|--------|------|
| 14 | 事業者営業自動化 | n8n + agent-browser でDM・メール一括送信 |
| 15 | アフィリエイト連携 | A8.net等への提携申請・リンク設置 |
| 16 | 口コミ投稿フォーム | ユーザーからの口コミ投稿機能 |
| 17 | 事業者管理画面 | Supabase Auth + パートナーポータル |
| 18 | Google Maps連携 | 事業者詳細ページに地図表示 |

---

## 付録

### A. 定数定義

```typescript
// 有効なカテゴリスラッグ
const VALID_CATEGORIES = ["sougi", "ohaka", "kaigo", "souzoku", "ihinseiri", "hoken"] as const;

// 地域グループ
const REGION_GROUPS = [
  { name: "北海道・東北", prefectures: ["hokkaido", "aomori", ...] },
  { name: "関東",         prefectures: ["ibaraki", "tochigi", ..., "kanagawa"] },
  { name: "中部",         prefectures: ["niigata", "toyama", ..., "aichi"] },
  { name: "近畿",         prefectures: ["mie", "shiga", ..., "wakayama"] },
  { name: "中国・四国",    prefectures: ["tottori", "shimane", ..., "kochi"] },
  { name: "九州・沖縄",    prefectures: ["fukuoka", "saga", ..., "okinawa"] },
];

// 料金帯ラベル
const PRICE_RANGE_LABELS = { low: "リーズナブル", mid: "標準", high: "ハイグレード" };

// 特徴オプション
const FEATURE_OPTIONS = [
  "24時間対応", "駐車場あり", "家族葬対応", "オンライン相談可",
  "バリアフリー", "送迎あり", "クレジットカード対応", "分割払い対応"
];

// サイト情報
const SITE_NAME = "安心終活ナビ";
const SITE_URL = "https://portal.shukatsu-ansin.com";
const WP_URL = "https://shukatsu-ansin.com";
```

### B. 環境変数（.env.example）

```bash
# Supabase（将来使用）
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJxxxxx

# メール送信（将来使用）
RESEND_API_KEY=re_xxxxx
```

### C. 関連ドキュメント

| ドキュメント | パス |
|-------------|------|
| ロードマップ | `プロジェクト設計/終活プラットフォーム_ロードマップ.md` |
| 競合分析（いい葬儀） | `競合サイト/e-sogi.md` |
| 技術スタック分析 | `競合サイト/e-sogi-技術スタック分析.md` |
